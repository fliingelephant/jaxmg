FROM quay.io/pypa/manylinux_2_28_x86_64

# Install NVIDIA CUDA Toolkit 13.0 and optional cuDNN on RHEL8 baseline
RUN dnf -y install dnf-plugins-core && \
    dnf config-manager --add-repo https://developer.download.nvidia.com/compute/cuda/repos/rhel8/x86_64/cuda-rhel8.repo && \
    dnf clean all && \
    dnf -y --nogpgcheck install cuda-toolkit-13-0 && \
    dnf -y --nogpgcheck install libnccl-2.28.9-1+cuda13.0 libnccl-devel-2.28.9-1+cuda13.0 && \
    dnf -y --nogpgcheck install libcudnn9-cuda-13 libcudnn9-devel-cuda-13 || true && \
    dnf -y install gcc-c++ make cmake git && \
    dnf clean all

# Create symlink from extras/CUPTI/include to main include directory and list headers
RUN mkdir -p /usr/local/cuda/extras/CUPTI && \
    ln -sfn /usr/local/cuda/include /usr/local/cuda/extras/CUPTI/include && \
    ls -la /usr/local/cuda/extras/CUPTI/include/cupti*.h || true